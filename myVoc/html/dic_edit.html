<!DOCTYPE html>
<meta name="viewport" content="width=device-width">
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>English Dictionary</title>
    <link rel="stylesheet" href="index.css">
    <script src="../js/ext.js"></script>
</head>


<html charset="UTF-8">

<head>
    <style>
    </style>
</head>

<body>
    <p>Edit Record</p>
    <!-- <form action="/dic_edit" method="POST" target="rsp" "> -->

    <table align=center width='100%' border=4>
        <tr>
            <td><label for="en">English:</label></td>
            <td>
                <input size='55' type="text" value="" id="en" name="en" autocomplete="off" onchange="" />
                <input type="button" name="button" value="Clear" onclick="document.getElementById('en').value = ''" />
            </td>
            <td align='center'> <input style="width:140px;" type="submit" name="button" value="Read"
                    onclick="doRead()" />
            </td>
        </tr>
        <tr>
            <td><label for="ru">Russian:</label></td>
            <td>
                <input size='55' type="text" value="" id="ru" name="ru" />
                <input type="button" name="button" value="Clear" onclick="document.getElementById('ru').value = ''" />
            </td>
            <td align='center'> <input style="width:140px;" type="submit" name="button" value="Edit"
                    onclick="doEdit()" />
            </td>
        </tr>
        <tr>
            <td><label for="cat">Category:</label></td>
            <td>
                <input list="Categories" size='55' id="cat" name="cat" value="Emotions">
                <datalist id="Categories">
                    <option value="Emotions">
                    <option value="Expression">
                    <option value="Business">
                    <option value="House">
                    <option value="Money">
                    <option value="Clothes">
                    <option value="Shopping">
                    <option value="Food">
                    <option value="Driving">
                    <option value="Transportation">
                    <option value="Health">
                    <option value="Work">
                    <option value="Study">
                    <option value="Phone">
                    <option value="Sport">
                    <option value="Politics">
                    <option value="Crime">
                    <option value="Travel">
                    <option value="Weather">
                    <option value="Greeting">
                    <option value="Other">
                </datalist>
                <input type="button" name="button" value="Clear" onclick="document.getElementById('cat').value = ''" />

            </td>
        </tr>
        <!-- </table> -->
        </form>

        <!--Response Table-->
        <table width='100%' height='500' border=1>
            <tr>
                <td>
                    <p align='left'>Response:</p>
                    <iframe title="frame" id=rsp name="rsp" width=100% height='600'
                        onselect="alert(innerText)"></iframe>
                </td>
            </tr>
        </table>

        <script>

            function doEnglish(e) {
                var target = e.target || e.srcElement;
                var text = target.textContent || target.innerText;
                document.getElementById('en').value = text;
            }
            function doRussian(e) {
                var target = e.target || e.srcElement;
                var text = target.textContent || target.innerText;
                document.getElementById('ru').value = text;
            }
            function doRow(e) {
                var target = e.target || e.srcElement;
                // var text = target.textContent || target.innerText;
                // var cellIndex = target.cellIndex;
                var tableRow = target.parentElement;
                tableRow.bgColor = "red";
                //tableRow.border = 5;
                var itemEn = tableRow.children.item(1).innerText;
                var itemRu = tableRow.children.item(2).innerText;
                var itemCa = tableRow.children.item(3).innerText;

                document.getElementById('en').value = itemEn;
                document.getElementById('ru').value = itemRu;
                document.getElementById('cat').value = itemCa;
            }
            function doRadio(e) {
                var target = e.target || e.srcElement;
                var tableRow = target.parentElement.parentElement;
                var itemEn = tableRow.children.item(1).innerText;
                var itemRu = tableRow.children.item(2).innerText;
                var itemCa = tableRow.children.item(3).innerText;

                document.getElementById('en').value = itemEn;
                document.getElementById('ru').value = itemRu;
                document.getElementById('cat').value = itemCa;
            }

            function HTMLBegin() {
                var html = "<HTML>\n<BODY>\n<TABLE style=\"width:100%\" border=1 >\n";

                var th =
                    "<tr>" +
                    "<th>Index</th>" +
                    "<th>English</th>" +
                    "<th>Russian</th>" +
                    "<th>Categoty</th>" +
                    "</tr>";
                html = html.concat(th);
                return html;
            }
            function HTMLAddRow(rec, nIndex) {
                var row = "<tr  id=\"" + 'ROW' + nIndex + "\" >";
                // var td = "<td>" + (nIndex) + "</td>";
                var td = "<td><input type='radio' id='RADIO" + nIndex + "' name='group' value='" + nIndex + "' >" + nIndex + "</td>";
                row = row.concat(td);
                td = "<td id=\"" + 'E' + nIndex + "\" >" + rec.en + "</td>";
                row = row.concat(td);
                td = "<td id=\"" + 'R' + nIndex + "\" >" + rec.ru + "</td>";
                row = row.concat(td);
                td = "<td>" + rec.cat + "</td>";
                row = row.concat(td);
                row = row.concat("</tr>");
                return row;
            }
            function HTMLEnd() {
                return ("\n</TABLE>\n</BODY>\n</HTML>");
            }

            //Convert to html grid
            function ConvertToHTML(result) {
                var html = HTMLBegin();
                var nIndex = 1;
                for (var j = 0; j < result.length; j++) {
                    var rec = result[j];
                    var row = HTMLAddRow(rec, nIndex);
                    html = html.concat(row);
                    nIndex++;
                }
                html = html.concat(HTMLEnd());
                return html;
            }

            function ajaxShowResponse() {
                var frm = document.getElementById('rsp');
                var doc = frm.contentDocument;

                let json = JSON.parse(this.responseText);
                var dic = json.dic;
                var html = ConvertToHTML(dic);
                doc.write(html);

                for (var i = 1; i < dic.length + 1; i++) {
                    // var idE = "E" + i;
                    // var idR = "R" + i;
                    var idRow = "ROW" + i;
                    var idRadio = "RADIO" + i;

                    // const e = doc.getElementById(idE);
                    // if(e!=null){
                    //     e.addEventListener("click", doEnglish, false);
                    // }
                    // const r = doc.getElementById(idR);
                    // if(r!=null){
                    //     r.addEventListener("click", doRussian, false);
                    // }

                    // const row = doc.getElementById(idRow);
                    // if(row!=null){
                    //     row.addEventListener("dblclick", doRow, false);
                    // }

                    const radio = doc.getElementById(idRadio);
                    if (radio != null) {
                        radio.addEventListener("change", doRadio, false);
                    }


                }
                doc.close();
            }

            function ajaxPost(url, d) {
                var oReq = new XMLHttpRequest();
                oReq.addEventListener("load", ajaxShowResponse);
                oReq.open("POST", url);
                oReq.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
                oReq.send(d);
            }


            function readReq(cmd) {
                var en = document.getElementById('en').value;
                var ru = document.getElementById('ru').value;
                var cat = document.getElementById('cat').value;

                var json =
                    "{"
                    + "\"button\":\"" + cmd + "\","
                    + "\"en\":\"" + en + "\","
                    + "\"ru\":\"" + ru + "\","
                    + "\"cat\":\"" + cat + "\""
                    + "}";
                var s = JSON.parse(json);
                var body = JSON.stringify(s);
                return body
            }

            function doRead() {
                var body = readReq("Read");
                ajaxPost("/dic_edit", body);
            }

            function doEdit() {
                var body = readReq("Edit");
                ajaxPost("/dic_edit", body);
            }

        </script>



</body>

</html>